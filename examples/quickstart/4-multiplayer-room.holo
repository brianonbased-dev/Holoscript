// 4-multiplayer-room.holo - Networked Multiplayer
// This example shows how to create multiplayer VR experiences

composition "Multiplayer Room" {
  environment {
    skybox: "sunset"
    ambient_light: 0.5
  }

  // Network configuration
  network {
    server: "wss://game.holoscript.net"
    room: auto  // Auto-create or join room
    max_players: 8
  }

  // Player template - each user gets one
  template "Player" {
    @networked
    @owned  // Only owner can move this
    
    state {
      name: ""
      color: "#ffffff"
      score: 0
    }

    // Avatar head (tracks headset)
    object "Head" {
      @tracked(source: "headset")
      geometry: "sphere"
      scale: [0.2, 0.25, 0.2]
    }

    // Left hand
    object "LeftHand" {
      @tracked(source: "left-controller")
      @hand_tracked
      geometry: "model/hand_left.glb"
    }

    // Right hand
    object "RightHand" {
      @tracked(source: "right-controller")
      @hand_tracked
      geometry: "model/hand_right.glb"
    }

    // Name tag floating above head
    object "NameTag" {
      @billboard
      position: [0, 0.4, 0]
      parent: "Head"
      
      text: this.name
      font_size: 0.1
      color: this.color
    }
  }

  // Shared objects - synced for all players
  object "SharedBall" {
    @grabbable
    @networked
    @physics
    
    geometry: "sphere"
    position: [0, 1, -2]
    scale: [0.3, 0.3, 0.3]
    color: "#e74c3c"
    
    on_grab: {
      // Claim ownership when grabbed
      network.claim(this)
    }
  }

  // Scoreboard
  object "Scoreboard" {
    position: [0, 2, -3]
    
    ui {
      layout: vertical
      background: "#2d3436"
      padding: 20
      
      text "Multiplayer Room" {
        size: 24
        color: "#ffffff"
      }
      
      text "Players Online: {network.player_count}" {
        size: 16
        color: "#74b9ff"
      }
      
      // Player list renders dynamically
      for player in network.players {
        row {
          text "{player.name}" { color: player.color }
          text "{player.score} pts" { color: "#ffffff" }
        }
      }
    }
  }

  // Goal zone - scores points
  object "GoalZone" {
    @trigger
    @glowing
    
    geometry: "cylinder"
    position: [0, 0.1, -5]
    scale: [1, 0.2, 1]
    color: "#00ff00"
    glow_intensity: 0.3
    
    physics: {
      type: "trigger"  // No collision, just detects
    }
    
    on_trigger_enter(other) {
      if (other.name == "SharedBall") {
        // Award point to whoever threw it
        let scorer = network.get_owner(other)
        scorer.score += 1
        
        // Reset ball position
        other.position = [0, 2, -2]
        
        // Celebrate!
        audio.play("goal")
        particles.emit("confetti", this.position)
      }
    }
  }

  logic {
    on_player_join(player) {
      // Welcome message
      ui.toast("ðŸ‘‹ {player.name} joined!")
      audio.play("join-chime")
    }
    
    on_player_leave(player) {
      ui.toast("ðŸšª {player.name} left")
    }
  }
}
